<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Styled Layout</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
    <!-- ÌîÑÎ°úÌïÑ ÏÑπÏÖò -->
    <!-- ÌÅ¥Î¶≠ Ïãú Ïù¥Îèô: id="profileLink" -->
    <div class="profile-section">
        <span id="profileLink">My Profile</span>
    </div>

    <!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
    <div class="container">
        <!-- ÌÉÄÏù¥ÌãÄ -->
        <div class="title">Title</div>

        <!-- ÏûÖÎ†• ÏÑπÏÖò -->
        <div class="input-wrapper">
            <!-- ÌÖçÏä§Ìä∏ ÏûÖÎ†•ÎûÄ -->
            <textarea 
                class="input-box" 
                placeholder="ÏùºÏ†ïÏùÑ ÎßåÎì§Í±∞ÎÇò Ïû•ÏÜåÎ•º Í≤ÄÏÉâÌï¥ Î≥¥ÏÑ∏Ïöî"
                rows="2"
            ></textarea>
            <!-- Í≤ÄÏùÄÏÉâ Î≤ÑÌäº -->
            <button class="send-button" onclick="goToEnterPage()">üîç</button>
        </div>
    </div>

    <!-- (A) DjangoÏóêÏÑú Î°úÍ∑∏Ïù∏ Ïó¨Î∂ÄÎ•º JS Î≥ÄÏàòÎ°ú ÎÑòÍπÄ -->
    <script>
        // user.is_authenticatedÎäî True ÎòêÎäî FalseÎ•º ÌååÏù¥Ïç¨ Î∂ÄÏö∏ÌòïÏúºÎ°ú Í∞ÄÏßÄÎØÄÎ°ú,
        // ÌÖúÌîåÎ¶ø ÌïÑÌÑ∞ yesno:"true,false"Î•º ÏÇ¨Ïö©Ìï¥ JSÏóêÏÑú Ïì∏ Ïàò ÏûàÎèÑÎ°ù Î≥ÄÌôò
        const isLoggedIn = {{ user.is_authenticated|yesno:"true,false" }};

        // (B) "My Profile" ÌÅ¥Î¶≠ Ïãú Ï≤òÎ¶¨
        document.addEventListener('DOMContentLoaded', function() {
            const profileLink = document.getElementById('profileLink');
            if (profileLink) {
                profileLink.addEventListener('click', function() {
                    if (isLoggedIn) {
                        // Î°úÍ∑∏Ïù∏Ïù¥ ÎêòÏñ¥ ÏûàÎã§Î©¥ ÌîÑÎ°úÌïÑ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
                        window.location.href = "/app/profile/";
                    } else {
                        // Ïïà ÎêòÏñ¥ ÏûàÎã§Î©¥ Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
                        window.location.href = "/login/";
                    }
                });
            }
        });

        function goToEnterPage() {
            const inputBox = document.querySelector('.input-box');
            const userInput = inputBox.value.trim();

            if (userInput === "") {
                alert("ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!");
                return;
            }

            // ÏûÖÎ†• Îç∞Ïù¥ÌÑ∞Î•º localStorageÏóê Ï†ÄÏû•
            localStorage.setItem('chatMessage', userInput);

            // SPA ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
            window.location.href = "/app/";
        }

        // ÏûÖÎ†•Ï∞Ω ÏûêÎèô ÎÜíÏù¥ Ï°∞Ï†ï Î∞è Î≤ÑÌäº ÏúÑÏπò Ïú†ÏßÄ
        document.querySelector('.input-box').addEventListener('input', function () {
            this.style.height = "auto";
            const scrollHeight = this.scrollHeight;
            const maxHeight = 120; // 6Ï§Ñ ÎÜíÏù¥ Ï†úÌïú
            this.style.height = `${Math.min(scrollHeight, maxHeight)}px`;

            if (scrollHeight > maxHeight) {
                this.style.overflowY = "scroll";
            } else {
                this.style.overflowY = "hidden";
            }
        });

        // Enter Î∞è Shift+Enter Ï≤òÎ¶¨
        document.querySelector('.input-box').addEventListener('keydown', function (e) {
            if (e.key === "Enter" && e.shiftKey) {
                e.preventDefault();
                const cursorPosition = this.selectionStart;
                this.value = this.value.slice(0, cursorPosition) + "\n" + this.value.slice(cursorPosition);
            } else if (e.key === "Enter") {
                e.preventDefault();
                document.querySelector('.send-button').click();
            }
        });
    </script>
</body>
</html>
